<style>
/* --- Floating Button & Tooltip --- */
#sw {
  position: fixed; bottom: 100px; right: 20px; display: flex; align-items: center; gap: 10px; z-index: 999999; cursor: pointer;
  animation: float 2s infinite ease-in-out;
}
@keyframes float { 0%,100%{transform: translateY(0)} 50%{transform: translateY(-5px)} }

#st {
  background: #001a33; color: #00bfff; padding: 6px 14px; border-radius: 20px; font-size: 14px;
  white-space: nowrap; opacity: 0; transform: translateX(10px); transition: .5s; box-shadow: 0 0 15px rgba(0,191,255,.4);
}
#sb {
  background: linear-gradient(135deg,#001a33,#0066ff); color: #fff; padding: 14px 20px; border-radius: 50px;
  font-size: 15px; box-shadow: 0 0 20px rgba(0,102,255,.7); transition: .3s; user-select: none;
}
#sb:hover { transform: scale(1.1) rotate(-2deg); box-shadow: 0 0 25px rgba(0,102,255,.9); }

/* --- Hover Menu --- */
#sm {
  position: fixed; bottom: 160px; right: 40px; display: flex; flex-direction: column; gap: 12px;
  opacity: 0; pointer-events: none; transition: .3s; transform: translateY(20px);
}
#sm.show { opacity: 1; pointer-events: auto; transform: translateY(0); }
.mc {
  width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
  font-size: 22px; cursor: pointer; box-shadow: 0 6px 15px rgba(0,0,0,.3); transition: .2s;
  background: linear-gradient(135deg,#007aff,#00bfff); color: black;
}
.mc:hover { transform: scale(1.15) rotate(10deg); box-shadow: 0 8px 20px rgba(0,0,0,.5); }

/* --- Popups --- */
#tp, #chat-popup {
  position: fixed; bottom: 150px; right: 20px; width: 320px; background: #001a33; color: white; border-radius: 15px;
  padding: 20px; box-shadow: 0 8px 30px rgba(0,0,0,.5); transform: translateY(50px) scale(.9);
  opacity: 0; pointer-events: none; transition: .4s; z-index: 999999; font-family: sans-serif;
}
#tp.show, #chat-popup.show { transform: translateY(0) scale(1); opacity: 1; pointer-events: auto; }

#tp input, #tp textarea, #chat-msg {
  width: 100%; margin-bottom: 8px; padding: 8px; border-radius: 6px; border: 1px solid #335; background: #000000cc; color: white;
  transition: .2s;
}
#tp input:focus, #tp textarea:focus, #chat-msg:focus { border-color: #00bfff; outline: none; }

#tp button, #chat-send {
  width: 100%; padding: 10px; border: none; border-radius: 6px;
  background: linear-gradient(135deg,#007aff,#00bfff); color: black; cursor: pointer; font-weight: bold; transition: .2s;
}
#tp button:hover, #chat-send:hover { transform: scale(1.05); box-shadow: 0 0 15px #00bfff; }

#tc, #chat-close {
  position: absolute; top: 8px; right: 12px; cursor: pointer; font-size: 22px; color: #bcd; transition: .2s;
}
#tc:hover, #chat-close:hover { color: #fff; }

#chat-popup { display: flex; flex-direction: column; bottom: 160px; }
#chat-log { flex: 1; overflow-y: auto; margin-bottom: 8px; border: 1px solid #335; padding: 8px; border-radius: 6px; background: #000000cc; font-size: 14px; max-height: 250px; }

/* --- Scroll animation --- */
#chat-log::-webkit-scrollbar { width: 6px; }
#chat-log::-webkit-scrollbar-thumb { background: #00bfff; border-radius: 3px; }
</style>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  // --- INSERT HTML ---
  document.body.insertAdjacentHTML("beforeend",`
  <div id="sw"><div id="st"></div><div id="sb">H·ªó tr·ª£</div></div>
  <div id="sm"><div class="mc" id="mt">üì©</div><div class="mc" id="mc">üí¨</div></div>
  <div id="tp"><div id="tc">√ó</div><h3>G·ª≠i y√™u c·∫ßu h·ªó tr·ª£</h3>
    <input id="tn" placeholder="T√™n c·ªßa b·∫°n">
    <input id="te" placeholder="Email">
    <textarea id="tm" placeholder="M√¥ t·∫£"></textarea>
    <button id="ts">G·ª≠i</button>
  </div>
  <div id="chat-popup"><div id="chat-close">√ó</div>
    <div id="chat-log"></div>
    <input id="chat-msg" placeholder="Nh·∫≠p tin nh·∫Øn">
    <button id="chat-send">G·ª≠i</button>
  </div>`);

  // --- Floating Text Animation ---
  const st = document.getElementById("st"), msgs = ["B·∫°n c·∫ßn h·ªó tr·ª£?", "B·∫°n c√≥ c√¢u h·ªèi g√¨ kh√¥ng?", "Chat ngay v·ªõi AI"];
  let i = 0;
  function next(){ st.style.opacity = 0; setTimeout(()=>{ st.textContent = msgs[i]; st.style.opacity = 1; i = (i+1)%msgs.length }, 500); }
  next(); setInterval(next, 8000);

  // --- Hover Menu ---
  const sb = document.getElementById("sb"), sm = document.getElementById("sm");
  let hoverTimer;
  function smOn(){ clearTimeout(hoverTimer); sm.classList.add("show"); }
  function smOff(){ hoverTimer = setTimeout(()=>sm.classList.remove("show"), 300); }
  sb.addEventListener("mouseenter", smOn); sb.addEventListener("mouseleave", smOff);
  sm.addEventListener("mouseenter", smOn); sm.addEventListener("mouseleave", smOff);

  // --- Ticket Popup ---
  const tp = document.getElementById("tp"), tc = document.getElementById("tc"), mtBtn = document.getElementById("mt");
  mtBtn.addEventListener("click", ()=>tp.classList.add("show"));
  tc.addEventListener("click", ()=>tp.classList.remove("show"));

  document.getElementById("ts").addEventListener("click", ()=>{
    const n = tn.value.trim(), e = te.value.trim(), m = tm.value.trim();
    if(!n || !e || !m){ alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß"); return; }
    alert("‚úî Ticket ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n!\nCh√∫ng t√¥i s·∫Ω ph·∫£n h·ªìi s·ªõm.");
    tp.classList.remove("show"); tn.value=""; te.value=""; tm.value="";
  });

  // --- Chatbot AI via Cloudflare Worker ---
  const chatPopup = document.getElementById("chat-popup"),
        chatClose = document.getElementById("chat-close"),
        chatLog = document.getElementById("chat-log"),
        chatInput = document.getElementById("chat-msg"),
        chatSend = document.getElementById("chat-send"),
        mcBtn = document.getElementById("mc");

  mcBtn.addEventListener("click", ()=>chatPopup.classList.add("show"));
  chatClose.addEventListener("click", ()=>{ chatPopup.classList.remove("show"); chatLog.innerHTML=""; });

  chatSend.addEventListener("click", async ()=>{
    const msg = chatInput.value.trim();
    if(!msg) return;
    chatLog.innerHTML += `<div><b>You:</b> ${msg}</div>`;
    chatLog.innerHTML += `<div>AI ƒëang tr·∫£ l·ªùi...</div>`;
    chatInput.value = "";
    chatLog.scrollTop = chatLog.scrollHeight;

    try{
      const res = await fetch("https://weathered-meadow-c4bc.thaihuyxbox.workers.dev/", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({messages:[{role:"user", content:msg}]})
      });
      const data = await res.json();
      const reply = data.choices?.[0]?.message?.content || "Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi";
      chatLog.innerHTML += `<div><b>AI:</b> ${marked.parse(reply)}</div>`;
    } catch(err){
      chatLog.innerHTML += `<div style="color:red"><b>AI:</b> L·ªói k·∫øt n·ªëi</div>`;
    }
    chatLog.scrollTop = chatLog.scrollHeight;
  });

});
</script>
